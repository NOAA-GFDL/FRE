#!/bin/csh -f

unalias *

alias printf    /usr/bin/printf
alias egrep     /bin/egrep
alias paste     /usr/bin/paste
alias sed       /bin/sed
alias tr        /usr/bin/tr
alias cvs       /usr/bin/cvs

printf "%-29s %-19s %-18s %s\n" `sh -c "cvs -q status $argv 2> /dev/null" | \
   egrep "Status|Sticky Tag|Working revision" | \
   paste -s | \
   sed "s/... ... .. ..:..:.. ....//g; \
        s/....-..-.. ..:..:.. .....//g; \
        s/([br][a-z]*:\s*[0-9.]*)//g; \
        s/Result of merge UTC//g; \
        s/Result of merge//g; \
        s/Working revision:\s*\([0-9\.]*\|New file.\)\s*Sticky Tag:\s*\((*[A-Za-z0-9_\.\-]*)*\)\s*/\2 \1/g; \
        s/File:/=/g; \
        s/Status://g; \
        s/no file //g; \
        s/- MISSING from RCS file.//g; \
        s/Unknown/Unknown Not_checked_out -- --/g; \
        s/Entry /Entry_/g; \
        s/Locally /Locally_/g; \
        s/No entry for //g; \
        s/Unresolved Conflict/Unresolved_Conflict/g; \
        s/No revision control file/-- No_file/g; \
        s/New /New_/g; \
        s/Needs /Needs_/g; \
        s/File had conflicts on merge/Merge_Conflicts/g" | \
   tr = "\n" `  

if ( ${#argv} == 0 ) then
   set untracked=`cvs -nq update |& \
      egrep '\?' | \
      paste -s | \
      sed "s/?/=/g" | \
      tr = "\n" `
   if ( ${#untracked} > 0 ) then
      printf "%-68s Untracked\n" `echo $untracked`
   endif
endif
